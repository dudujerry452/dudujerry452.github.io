<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SQL笔记 | dudujerry的Coding世界!</title><meta name="author" content="dudujerry"><meta name="copyright" content="dudujerry"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SQL命令查询结构基本结构123select 列名    from 表名    where 条件表达式 产生一个关系作为结果，其中from中引用的表之间使用笛卡尔积连接 示例：给出所有女同学的姓名： 1select SNAME from S where SSEX &#x3D; &#x27;女&#x27; 详细结构1234567select [ALL | DISTINCT] &lt;列名&gt;[, &lt;">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL笔记">
<meta property="og:url" content="https://dudujerry452.github.io/2025/08/21/db-sql/index.html">
<meta property="og:site_name" content="dudujerry的Coding世界!">
<meta property="og:description" content="SQL命令查询结构基本结构123select 列名    from 表名    where 条件表达式 产生一个关系作为结果，其中from中引用的表之间使用笛卡尔积连接 示例：给出所有女同学的姓名： 1select SNAME from S where SSEX &#x3D; &#x27;女&#x27; 详细结构1234567select [ALL | DISTINCT] &lt;列名&gt;[, &lt;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dudujerry452.github.io/img/girl_avater.jpg">
<meta property="article:published_time" content="2025-08-21T01:48:55.000Z">
<meta property="article:modified_time" content="2025-08-21T02:18:56.507Z">
<meta property="article:author" content="dudujerry">
<meta property="article:tag" content="database">
<meta property="article:tag" content="sql">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dudujerry452.github.io/img/girl_avater.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "SQL笔记",
  "url": "https://dudujerry452.github.io/2025/08/21/db-sql/",
  "image": "https://dudujerry452.github.io/img/girl_avater.jpg",
  "datePublished": "2025-08-21T01:48:55.000Z",
  "dateModified": "2025-08-21T02:18:56.507Z",
  "author": [
    {
      "@type": "Person",
      "name": "dudujerry",
      "url": "https://dudujerry452.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://dudujerry452.github.io/2025/08/21/db-sql/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SQL笔记',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/girl_avater.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E6%9D%82%E8%B0%88/"><i class="fa-fw fas fa-music"></i><span> 杂谈</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/lizard.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">dudujerry的Coding世界!</span></a><a class="nav-page-title" href="/"><span class="site-name">SQL笔记</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E6%9D%82%E8%B0%88/"><i class="fa-fw fas fa-music"></i><span> 杂谈</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">SQL笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-21T01:48:55.000Z" title="发表于 2025-08-21 09:48:55">2025-08-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-21T02:18:56.507Z" title="更新于 2025-08-21 10:18:56">2025-08-21</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="SQL命令"><a href="#SQL命令" class="headerlink" title="SQL命令"></a>SQL命令</h1><h2 id="查询结构"><a href="#查询结构" class="headerlink" title="查询结构"></a>查询结构</h2><h3 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 列名</span><br><span class="line">    <span class="keyword">from</span> 表名</span><br><span class="line">    <span class="keyword">where</span> 条件表达式</span><br></pre></td></tr></table></figure>
<p>产生一个关系作为结果，其中from中引用的表之间使用笛卡尔积连接</p>
<p>示例：给出所有女同学的姓名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SNAME <span class="keyword">from</span> S <span class="keyword">where</span> SSEX <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="详细结构"><a href="#详细结构" class="headerlink" title="详细结构"></a>详细结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> [<span class="keyword">ALL</span> <span class="operator">|</span> <span class="keyword">DISTINCT</span>] <span class="operator">&lt;</span>列名<span class="operator">&gt;</span></span><br><span class="line">[, <span class="operator">&lt;</span>列名<span class="operator">&gt;</span> ] ...</span><br><span class="line"><span class="keyword">from</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> [, <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> ] ...</span><br><span class="line">[<span class="keyword">where</span> <span class="operator">&lt;</span>行条件表达式<span class="operator">&gt;</span>]</span><br><span class="line">[<span class="keyword">group</span> <span class="keyword">by</span> <span class="operator">&lt;</span>列名<span class="operator">&gt;</span> [, <span class="operator">&lt;</span>列名<span class="operator">&gt;</span> ] ...]</span><br><span class="line">[<span class="keyword">having</span> <span class="operator">&lt;</span>条件表达式<span class="operator">&gt;</span>]</span><br><span class="line">[<span class="keyword">order</span> <span class="keyword">by</span> <span class="operator">&lt;</span>列名<span class="operator">&gt;</span> [<span class="keyword">asc</span> <span class="operator">|</span> <span class="keyword">desc</span>] ...]</span><br></pre></td></tr></table></figure>
<p><strong>工作过程：</strong></p>
<ol>
<li>读取from子句的表或视图做笛卡尔积</li>
<li>where子句找出满足条件表达式的元组</li>
<li>按group by子句指定列名分组，值相等的元素为一组，每个组产生结果表中的一条记录。可在每组中与聚集函数；若group子句带having，则只有满足条件的组才被输出</li>
<li>按select子句中给出的列名或表达式求值输出</li>
<li>order by子句对输出结果排序</li>
</ol>
<h3 id="其他运算符"><a href="#其他运算符" class="headerlink" title="其他运算符"></a>其他运算符</h3><p><strong>where:</strong></p>
<ul>
<li>&lt;, &lt;=, =, &lt;&gt;或!=</li>
<li>and, or, not</li>
</ul>
<p><strong>集合:</strong></p>
<ul>
<li>union, intersect, except</li>
</ul>
<p><strong>集合成员资格：</strong></p>
<ul>
<li>in, not in</li>
</ul>
<p><strong>谓词:</strong></p>
<ul>
<li>exists, not exists, all, some, unique, between … and …, not between … and …, like, not like, is null …</li>
</ul>
<p><strong>聚集函数:</strong></p>
<ul>
<li>avg, min ,max, sum, count …</li>
</ul>
<h3 id="重复函数的处理"><a href="#重复函数的处理" class="headerlink" title="重复函数的处理"></a>重复函数的处理</h3><p>语法：默认为保留重复元组，也可以用all指定。若要去掉重复元组，可用distinct指明。</p>
<h3 id="from子句"><a href="#from子句" class="headerlink" title="from子句"></a>from子句</h3><p>from子句列出查询需要访问的关系列表。当目标属性取自多个关系时，不混淆则可以不用显式指明来自哪个关系。</p>
<h3 id="自然连接"><a href="#自然连接" class="headerlink" title="自然连接"></a>自然连接</h3><ul>
<li><code>from table1 natural join table2</code></li>
</ul>
<p>自然连接将参与连接的表相同的列名合并，其余属性跟随相同的列排布。</p>
<h2 id="分组聚集"><a href="#分组聚集" class="headerlink" title="分组聚集"></a>分组聚集</h2><h3 id="分组命令"><a href="#分组命令" class="headerlink" title="分组命令"></a>分组命令</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 列名 [<span class="keyword">having</span> 条件表达式]:</span><br></pre></td></tr></table></figure>
<p>按照列的值分组，对每个组别进行聚集运算。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">having</span></span><br></pre></td></tr></table></figure>
<p>则对分组进行选择。</p>
<p><strong>示例1:</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> DNO, <span class="built_in">max</span>(SAL), <span class="built_in">min</span>(SAL)</span><br><span class="line"><span class="keyword">from</span> PROF</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> DNO</span><br></pre></td></tr></table></figure>
<p>根据部门编号分组，对每个部门，求出最大工资和最小工资。</p>
<p><strong>示例2:</strong></p>
<p>列出2009年讲授的每个课程段,至少有两名学生选课的总学分平均值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> course_id, sec_id, semeseter, <span class="keyword">year</span>, <span class="built_in">avg</span>(tot_cred)</span><br><span class="line">    <span class="keyword">from</span> takes <span class="keyword">natural</span> <span class="keyword">join</span> student</span><br><span class="line">    <span class="keyword">where</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2009</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> course_id, sec_id, semeseter, <span class="keyword">year</span></span><br><span class="line">    <span class="keyword">having</span> <span class="built_in">count</span>(ID) <span class="operator">&gt;=</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>
<h2 id="嵌套子查询"><a href="#嵌套子查询" class="headerlink" title="嵌套子查询"></a>嵌套子查询</h2><h3 id="集合成员资格"><a href="#集合成员资格" class="headerlink" title="集合成员资格"></a>集合成员资格</h3><p><strong>连接词in测试元组是否是集合中的成员</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> S</span><br><span class="line"><span class="keyword">where</span> SNAME <span class="keyword">in</span>(<span class="string">&#x27;张红&#x27;</span>, <span class="string">&#x27;王军&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>同理，使用not in测试元组不在集合中。</p>
<p><strong>in子查询</strong></p>
<p>判断表达式的值是不是在子查询的结果集合中。</p>
<p>例如：选修了001号课程的学生的学号及姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SNO,SNAME</span><br><span class="line"><span class="keyword">from</span> S</span><br><span class="line"><span class="keyword">where</span> SNO <span class="keyword">in</span></span><br><span class="line">        (<span class="keyword">select</span> SNO</span><br><span class="line">        <span class="keyword">from</span> SC</span><br><span class="line">        <span class="keyword">where</span> CNO <span class="operator">=</span> <span class="string">&#x27;001&#x27;</span></span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<p>再例如筛选同一张表的多个条件，此时用其他方法十分麻烦：选修了001号且选了002号课程的学生的学号及姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SNO,SNAME</span><br><span class="line"><span class="keyword">from</span> S</span><br><span class="line"><span class="keyword">where</span> CNO <span class="operator">=</span> <span class="string">&#x27;001&#x27;</span></span><br><span class="line"><span class="keyword">and</span> SNO <span class="keyword">in</span></span><br><span class="line">        (<span class="keyword">select</span> SNO</span><br><span class="line">        <span class="keyword">from</span> SC</span><br><span class="line">        <span class="keyword">where</span> CNO <span class="operator">=</span> <span class="string">&#x27;002&#x27;</span></span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<p>也可以与集合成员资格判断一起使用，此代码可以找出选修了10101号老师的课的不同的学生总数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> SNO)</span><br><span class="line"><span class="keyword">from</span> takes</span><br><span class="line"><span class="keyword">where</span>(coutse_id, sec_id, semester, <span class="keyword">year</span>) <span class="keyword">in</span></span><br><span class="line">        (<span class="keyword">select</span> coutse_id, sec_id, semester, <span class="keyword">year</span></span><br><span class="line">        <span class="keyword">from</span> teaches</span><br><span class="line">        <span class="keyword">where</span> ID <span class="operator">=</span> <span class="string">&#x27;10101&#x27;</span></span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<h3 id="集合的比较"><a href="#集合的比较" class="headerlink" title="集合的比较"></a>集合的比较</h3><p>结构：</p>
<ul>
<li><p>表达式 比较运算符 θ some(子查询)<br>意思是，表达式的值至少与子查询结果中的一个值相比满足比较运算符θ。<br>注意， <code>=some</code> 等价于 <code>in</code>, 但 <code>!=some</code> 不等价于 <code>not in</code>。</p>
</li>
<li><p>表达式 比较运算符 θ all(子查询)<br>相似地，表达式的值与子查询结果中的所有值相比都满足比较运算符θ。<br>注意， <code>!=all</code> 等价于 <code>not in</code>, 但 <code>=all</code> 不等价于 <code>in</code>。</p>
</li>
</ul>
<p><strong>注意，集合的比较在可读性上比笛卡尔积优越，如如下例子</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> T.name</span><br><span class="line"><span class="keyword">from</span> instructor T, instructor S</span><br><span class="line"><span class="keyword">where</span> T.salary <span class="operator">&gt;</span> S.salary</span><br><span class="line"><span class="keyword">and</span> S.dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span></span><br></pre></td></tr></table></figure>
<p>可以改写为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> name</span><br><span class="line"><span class="keyword">from</span> instructor T</span><br><span class="line"><span class="keyword">where</span> salary <span class="operator">&gt;</span> <span class="keyword">some</span>(</span><br><span class="line">                <span class="keyword">select</span> salary</span><br><span class="line">                <span class="keyword">from</span> instructor S</span><br><span class="line">                <span class="keyword">where</span> S.dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span></span><br><span class="line">                )</span><br></pre></td></tr></table></figure>
<p>选出工资大于生物系某个老师工资的老师的名字。</p>
<p>也可以进一步对聚集运算的结果操作：选出平均成绩大于所有学生平均成绩的学生学号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SNO</span><br><span class="line"><span class="keyword">from</span> SC</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> SNO</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">avg</span>(GRADE) <span class="operator">&gt;=</span> <span class="keyword">all</span></span><br><span class="line">            (<span class="keyword">select</span> <span class="built_in">avg</span>(GRADE)</span><br><span class="line">            <span class="keyword">from</span> SC</span><br><span class="line">            <span class="keyword">group</span> <span class="keyword">by</span> SNO)</span><br></pre></td></tr></table></figure>
<h3 id="空关系测试"><a href="#空关系测试" class="headerlink" title="空关系测试"></a>空关系测试</h3><ul>
<li><code>[not] exists (子查询)</code><br>判段子查询的结果集合中是否有任何元组存在。</li>
</ul>
<p>注意：<br><strong>in后的子查询与外层查询无关，每个子查询执行一次，而exists后的子查询与外层查询有关，使用了来自外层的相关查询名称，会执行多次</strong><br>并且，exists子查询的名称只能来源于子查询和其父查询。</p>
<p>例如，列出2009年秋季和2010春季同时开课的所有课程id</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> course_id</span><br><span class="line"><span class="keyword">from</span> section</span><br><span class="line"><span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2009</span> <span class="keyword">and</span></span><br><span class="line">    course_id <span class="keyword">in</span> ( <span class="keyword">select</span> course_id</span><br><span class="line">                <span class="keyword">from</span> section</span><br><span class="line">                <span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2010</span></span><br><span class="line">                );</span><br></pre></td></tr></table></figure>
<p>可以改写为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> course_id</span><br><span class="line"><span class="keyword">from</span> section S1</span><br><span class="line"><span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2009</span> <span class="keyword">and</span></span><br><span class="line">    <span class="keyword">exists</span> (<span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">            <span class="keyword">from</span> section S2</span><br><span class="line">            <span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2010</span></span><br><span class="line">            <span class="keyword">and</span> S1.course_id <span class="operator">=</span> S2.course_id</span><br><span class="line">            );</span><br></pre></td></tr></table></figure>
<p><strong>集合包含测试</strong></p>
<ul>
<li>若关系A包含关系B（A为B的超集）， 则 <code>not exists (B [except/minus] A)</code></li>
<li>对 <code>B except A</code> 可以表达在B中存在， 在A中不存在的记录。若B是A的子集，则B except A结果为空集，则 <code>not exists (B except A)</code> 为真。</li>
</ul>
<p>例子：列出选修了Biology系开设的所有课程的学生id，姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> S.ID, S.name</span><br><span class="line"><span class="keyword">from</span> student S</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">    (</span><br><span class="line">        (<span class="keyword">select</span> course_id</span><br><span class="line">        <span class="keyword">from</span> course</span><br><span class="line">        <span class="keyword">where</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span> )</span><br><span class="line">        <span class="keyword">except</span></span><br><span class="line">        (</span><br><span class="line">        <span class="keyword">select</span> T.course_id</span><br><span class="line">        <span class="keyword">from</span> takes <span class="keyword">as</span> T</span><br><span class="line">        <span class="keyword">where</span> S.ID <span class="operator">=</span> T.ID</span><br><span class="line">        )</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>思路：对于生物系开设的所有课程，对于每个学生，减去每个学生修的课，如果结果为空，说明生物系的所有课是该学生的课的子集，即该学生选修了生物系的所有课。</p>
<p>列出选修了所有课程的学生名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SNAME <span class="keyword">from</span> S</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span> (</span><br><span class="line">    <span class="keyword">select</span> CNO <span class="keyword">from</span> course</span><br><span class="line">    <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span>(</span><br><span class="line">        <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> SC</span><br><span class="line">        <span class="keyword">where</span> SC.SNO <span class="operator">=</span> S.SNO <span class="keyword">and</span> SC.CNO <span class="operator">=</span> course.CNO</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>思路：对于每一个学生，检查所有课程，若不存在这样一门课——不属于该学生选课的课程不存在，那么该学生选修了所有课程。</p>
<h3 id="重复元素存在性检测"><a href="#重复元素存在性检测" class="headerlink" title="重复元素存在性检测"></a>重复元素存在性检测</h3><ul>
<li><code>[not] unique (子查询)</code><br>若子查询中没有重复的元素（不存在的元素也算没有重复）则为真。</li>
</ul>
<p>例子: 列出2017年最多开设一次的所有课程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> T.course_id</span><br><span class="line"><span class="keyword">from</span> course <span class="keyword">as</span> T</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">unique</span></span><br><span class="line">    (<span class="keyword">select</span> R.course_id</span><br><span class="line">    <span class="keyword">from</span> section <span class="keyword">as</span> R</span><br><span class="line">    <span class="keyword">where</span> T.course_id <span class="operator">=</span> R.course_id</span><br><span class="line">    <span class="keyword">and</span> R.year <span class="operator">=</span> <span class="number">2017</span> )</span><br></pre></td></tr></table></figure>
<p>思路：对于每一个课程，检查该课程号在学期表中是否唯一，值的注意的是一次都没开unique也算为真。</p>
<p>等价代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> T.course_id</span><br><span class="line"><span class="keyword">from</span> course <span class="keyword">as</span> T</span><br><span class="line"><span class="keyword">where</span> <span class="number">1</span> <span class="operator">&gt;=</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">count</span>(R.course_id)</span><br><span class="line">    <span class="keyword">from</span> section <span class="keyword">as</span> R</span><br><span class="line">    <span class="keyword">where</span> T.course_id <span class="operator">=</span> R.course_id <span class="keyword">and</span></span><br><span class="line">    R.year <span class="operator">=</span> <span class="number">2017</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="from子句中的子查询"><a href="#from子句中的子查询" class="headerlink" title="from子句中的子查询"></a>from子句中的子查询</h3><ul>
<li><code>(子查询) as 关系名 [列名, 列名 ...]</code><br>将子查询的结果作为新的表运算。</li>
</ul>
<p>示例：找出平均成绩及格的学生</p>
<p>思路：<br>(1)求出每个学生平均成绩<br>(2)再从中找出及格的学生（替换having子句）</p>
<p><strong>(1)求出每个学生平均成绩的子查询表达</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SNAME,<span class="built_in">avg</span>(GRADE)</span><br><span class="line"><span class="keyword">from</span> S, SC</span><br><span class="line"><span class="keyword">where</span> S.SNO <span class="operator">=</span> SC.SNO</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> SNAME</span><br></pre></td></tr></table></figure>
<p><strong>(2) 找出及格的学生</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SNAME, AVG_GRADE</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> SNAME, <span class="built_in">avg</span>(GRADE)</span><br><span class="line">    <span class="keyword">from</span> S, SC</span><br><span class="line">    <span class="keyword">where</span> SC.SNO  <span class="operator">=</span> S.SNO</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> SC.SNO, SNAME</span><br><span class="line">) <span class="keyword">as</span> <span class="keyword">result</span>(SNAME, AVG_GRADE)</span><br><span class="line"><span class="keyword">where</span> AVG_GRADE <span class="operator">&gt;=</span> <span class="number">60</span>;</span><br></pre></td></tr></table></figure>
<h2 id="with子句"><a href="#with子句" class="headerlink" title="with子句"></a>with子句</h2><p>with子句提供定义临时关系的方法。定义仅对包含with子句的查询有效。</p>
<ul>
<li>例子：找出最大预算值的系</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> max_budget(<span class="keyword">value</span>) <span class="keyword">as</span></span><br><span class="line">    (<span class="keyword">select</span> <span class="built_in">max</span>(budget)</span><br><span class="line">    <span class="keyword">from</span> department)</span><br><span class="line"><span class="keyword">select</span> dept_name, budget</span><br><span class="line"><span class="keyword">from</span> department, max_budget</span><br><span class="line"><span class="keyword">where</span> department.budget <span class="operator">=</span> max_budget.value;</span><br></pre></td></tr></table></figure>
<p>思路：先准备部门的最大预算，再筛选出这个最大预算值的部门。</p>
<ul>
<li>例子：查出所有工资总和大与所有系工资总额平均值的系</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> dept_total (dept_name, <span class="keyword">value</span>) <span class="keyword">as</span></span><br><span class="line">    (<span class="keyword">select</span> dept_name, <span class="built_in">sum</span>(salary)</span><br><span class="line">    <span class="keyword">from</span> instructor</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> dept_name),</span><br><span class="line"></span><br><span class="line">    dept_total_avg(<span class="keyword">value</span>) <span class="keyword">as</span></span><br><span class="line">    (<span class="keyword">select</span> <span class="built_in">avg</span>(<span class="keyword">value</span>)</span><br><span class="line">    <span class="keyword">from</span> dept_total)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> dept_name</span><br><span class="line"><span class="keyword">from</span> dept_total, dept_total_avg</span><br><span class="line"><span class="keyword">where</span> dept_total.value <span class="operator">&gt;=</span> dept_total_avg.value;</span><br></pre></td></tr></table></figure>
<p>思路：先求出每个系的工资总额，再求出所有系的工资总额的平均值，最后筛选出工资总额大于平均值的系。我认为，这样的写法十分优雅，而且很有条理，可读性好。</p>
<h3 id="标量子查询"><a href="#标量子查询" class="headerlink" title="标量子查询"></a>标量子查询</h3><ul>
<li>值返回单个属性的子查询，可出现在任意要求单个值的表达式中，如select。</li>
</ul>
<p>例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dept_name,</span><br><span class="line">    (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">from</span> instructor</span><br><span class="line">    <span class="keyword">where</span> department.dept_name <span class="operator">=</span> instructor.dept_name)</span><br><span class="line">    <span class="keyword">as</span> num_instructors</span><br><span class="line"><span class="keyword">from</span> department;</span><br></pre></td></tr></table></figure>
<p>思路：对于每一个部门，先计算出教师总数，再直接输出。</p>
<h2 id="插入操作"><a href="#插入操作" class="headerlink" title="插入操作"></a>插入操作</h2><p>插入操作可以使用VALUES，也可以使用子查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> [<span class="keyword">table</span> name]</span><br><span class="line">    <span class="keyword">values</span>([值, ] ...)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> [<span class="keyword">table</span> name] ([列名, ] ...)</span><br><span class="line">    <span class="keyword">values</span>([值, ] ...)</span><br></pre></td></tr></table></figure>
<h2 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h2><p>删除PROF中的所有元组：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> PROF</span><br></pre></td></tr></table></figure>
<p>删除王明老师所有的任课记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> PC</span><br><span class="line"><span class="keyword">where</span> PNO <span class="keyword">in</span>(</span><br><span class="line">    <span class="keyword">select</span> PNO <span class="keyword">from</span> PROF</span><br><span class="line">    <span class="keyword">where</span> NAME <span class="operator">=</span> <span class="string">&#x27;王明&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="更新操作"><a href="#更新操作" class="headerlink" title="更新操作"></a>更新操作</h2><p>所有老师工资上调5%：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> instructor</span><br><span class="line"><span class="keyword">set</span> salary <span class="operator">=</span> salary<span class="operator">*</span><span class="number">1.05</span></span><br></pre></td></tr></table></figure>
<p>将系主任的工资改为系平均工资：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> PROF</span><br><span class="line"><span class="keyword">set</span> SAL <span class="operator">=</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(SAL)</span><br><span class="line">            <span class="keyword">from</span> PROF</span><br><span class="line">            <span class="keyword">where</span> DNO <span class="operator">=</span> D01)</span><br><span class="line"><span class="keyword">where</span> PNO <span class="operator">=</span> (<span class="keyword">select</span> DEAN</span><br><span class="line">            <span class="keyword">from</span> DEPT</span><br><span class="line">            <span class="keyword">where</span> DNO <span class="operator">=</span> D01)</span><br></pre></td></tr></table></figure>
<p>对工资超过100000的涨3%，其余的涨5%的工资：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> instructor</span><br><span class="line"><span class="keyword">set</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.03</span></span><br><span class="line"><span class="keyword">where</span> salary <span class="operator">&gt;</span> <span class="number">100000</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> instructor</span><br><span class="line"><span class="keyword">set</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.05</span></span><br><span class="line"><span class="keyword">where</span> salary <span class="operator">&lt;=</span> <span class="number">100000</span></span><br></pre></td></tr></table></figure>
<p>注意命令顺序不能颠倒。</p>
<h3 id="case更新操作"><a href="#case更新操作" class="headerlink" title="case更新操作"></a>case更新操作</h3><p>语法格式:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span></span><br><span class="line">    <span class="keyword">when</span> pred1 <span class="keyword">then</span> result1</span><br><span class="line">    <span class="keyword">when</span> pred2 <span class="keyword">then</span> result2</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">when</span> predn <span class="keyword">then</span> resultn</span><br><span class="line">    <span class="keyword">else</span> result0</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>上一个示例可以改为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> instructor</span><br><span class="line"><span class="keyword">set</span> salary <span class="operator">=</span> <span class="keyword">case</span></span><br><span class="line">        <span class="keyword">when</span> salary <span class="operator">&gt;</span> <span class="number">100000</span> <span class="keyword">then</span> salary <span class="operator">*</span> <span class="number">1.03</span></span><br><span class="line">        <span class="keyword">else</span> salary <span class="operator">*</span> <span class="number">1.05</span></span><br><span class="line">    <span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>把student中每个tot_cred属性设为学生成功学完所有课程（成绩既不是F也不是空）的学分总和：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> student S</span><br><span class="line"><span class="keyword">set</span> tot_cred <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">sum</span>(credits)</span><br><span class="line">    <span class="keyword">from</span> takes <span class="keyword">natural</span> <span class="keyword">join</span> course</span><br><span class="line">    <span class="keyword">where</span> S.ID <span class="operator">=</span> takes.ID</span><br><span class="line">    <span class="keyword">and</span> takes.grade <span class="operator">&lt;&gt;</span> <span class="string">&#x27;F&#x27;</span></span><br><span class="line">    <span class="keyword">and</span> takes.grade <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>添加要求：没学完任何课程的学生学分为0</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> student S</span><br><span class="line"><span class="keyword">set</span> tot_cred <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">case</span></span><br><span class="line">    <span class="keyword">when</span> <span class="built_in">sum</span>(credits) <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">then</span> <span class="built_in">sum</span>(credits)</span><br><span class="line">    <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">from</span> takes <span class="keyword">natural</span> <span class="keyword">join</span> course</span><br><span class="line">    <span class="keyword">where</span> S.ID <span class="operator">=</span> takes.ID</span><br><span class="line">    <span class="keyword">and</span> takes.grade <span class="operator">&lt;&gt;</span> <span class="string">&#x27;F&#x27;</span></span><br><span class="line">    <span class="keyword">and</span> takes.grade <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="连接表达式"><a href="#连接表达式" class="headerlink" title="连接表达式"></a>连接表达式</h2><p><strong>自然连接：</strong><br>结果的公共属性上取值相等，且只出现一次。</p>
<p><strong>join … using (A1, A2 … )</strong><br>结果的公共属性子集(A1, A2 … )取值相等，且只出现一次。</p>
<p><strong>join … on &lt;谓词&gt;</strong><br>结果的公共属性满足谓词的要求，且出现两次。</p>
<h3 id="内连接和外连接"><a href="#内连接和外连接" class="headerlink" title="内连接和外连接"></a>内连接和外连接</h3><p><strong>内连接</strong>：只返回参与运算的两个表的匹配的部分。<br><strong>外连接</strong>：在内连接分基础上，加上左侧或右侧不匹配的部分（匹配内容为空的）。<br><strong>左外连接(left outer join) / 右外连接(right outer join)</strong>: 如上。</p>
<p>例如:<br>表1:<br>| id  | name  |<br>| —- | ——- |<br>| 1   | Bob   |<br>| 2   | Alice |<br>| 3   | King  |</p>
<p>表2:<br>| name  | age |<br>| ——- | —- |<br>| Bob   | 22  |<br>| Alice | 23  |<br>| Jerry | 24  |</p>
<p><strong>内连接的效果为：</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Bob</td>
<td>22</td>
</tr>
<tr>
<td>2</td>
<td>Alice</td>
<td>23</td>
</tr>
</tbody>
</table>
</div>
<p><strong>左外连接的效果为：</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Bob</td>
<td>22</td>
</tr>
<tr>
<td>2</td>
<td>Alice</td>
<td>23</td>
</tr>
<tr>
<td>3</td>
<td>King</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
<p><strong>右外连接的效果为：</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Bob</td>
<td>22</td>
</tr>
<tr>
<td>2</td>
<td>Alice</td>
<td>23</td>
</tr>
<tr>
<td>null</td>
<td>Jerry</td>
<td>24</td>
</tr>
</tbody>
</table>
</div>
<p><strong>全外连接</strong><br>| id   | name  | age  |<br>| —— | ——- | —— |<br>| 1    | Bob   | 22   |<br>| 2    | Alice | 23   |<br>| 3    | King  | null |<br>| null | Jerry | 24   |</p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>作为虚关系，对用户可见的关系。</p>
<p><strong>定义：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> view_name[(列名[,列名]....)]</span><br><span class="line">    <span class="keyword">as</span> (查询表达式)</span><br></pre></td></tr></table></figure>
<p>视图的属性名缺省为子查询结果中的属性名，可以显示指明。</p>
<p><strong>删除视图：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> view_name</span><br></pre></td></tr></table></figure>
<p><strong>视图的逻辑分层</strong><br>| | |<br>| —- | —- |<br>| 外模式 | view |<br>| 模式 | logic |<br>| 内模式 | physics |</p>
<h3 id="物化视图"><a href="#物化视图" class="headerlink" title="物化视图"></a>物化视图</h3><p>某些DBS允许存储视图，但保证如果定义视图的实际关系改变，视图也跟着改变。</p>
<h3 id="视图更新"><a href="#视图更新" class="headerlink" title="视图更新"></a>视图更新</h3><p>称视图是可更新的，当且仅当：</p>
<ul>
<li>from子句中仅有一个数据库关系</li>
<li>select只包含关系属性名，不包含表达式，聚集以及distinct声明</li>
<li>出现在select子句中的属性限制null</li>
<li>查询中不包含group, having子句（保证单射）</li>
</ul>
<p><strong>with check option</strong><br>视图定义时，指定with check option，检查通过视图修改时，结果必须在视图中，否则拒绝更新。</p>
<p>在试图进行不符合view条件的更新时：</p>
<ul>
<li><strong>没有with check option</strong> ：可以更新，更新后元组不再出现在视图中</li>
<li><strong>有with check option</strong> ：不可以更新</li>
</ul>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p><strong>开端：</strong> 执行一条新的sql语句</p>
<p><strong>结束：</strong></p>
<ul>
<li><code>commit work</code> 结束事务并提交</li>
<li><code>rollback work</code> 事务没有完成，回滚数据</li>
<li><code>commit/rollback</code> 事务完成，其后的sql属于新的事务</li>
</ul>
<h2 id="完整性约束"><a href="#完整性约束" class="headerlink" title="完整性约束"></a>完整性约束</h2><ul>
<li><strong>完整性：</strong> 数据的正确性和相容性</li>
<li><strong>完整性检查：</strong> DMBS提供一种机制确保DB中的数据满足完整性规范</li>
</ul>
<p>单个关系的约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> [约束]</span><br></pre></td></tr></table></figure>
<p>约束：</p>
<ul>
<li>not null</li>
<li>unique</li>
<li>check &lt;谓词&gt;</li>
</ul>
<h3 id="属性值上的约束"><a href="#属性值上的约束" class="headerlink" title="属性值上的约束"></a>属性值上的约束</h3><ul>
<li><strong>not null</strong>：非空约束 要求某属性取值不能为空</li>
<li><strong>unique</strong>：唯一性约束，要求该列为一超码，但隐式允许属性为空，除非显式声明</li>
<li><strong>check(P)</strong>：要求每个值都满足check(P)</li>
</ul>
<p><strong>check子句</strong><br>… TODO : 补完ppt</p>
<h2 id="参照完整性约束"><a href="#参照完整性约束" class="headerlink" title="参照完整性约束"></a>参照完整性约束</h2><h3 id="references子句"><a href="#references子句" class="headerlink" title="references子句"></a>references子句</h3><p>写法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dept_name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">references</span> department</span><br></pre></td></tr></table></figure>
<p>当违反约束时，通常直接拒绝执行造成破坏完整性的操作。</p>
<p><strong>foreign key子句</strong><br>foreign key子句可以指明，如果参照关系上的删除或更新操作违反了约束，系统需要在被参照关系中进行修改来满足参照完整性约束，而不是简单地拒绝操作。</p>
<h3 id="修改基本关系主码的情况"><a href="#修改基本关系主码的情况" class="headerlink" title="修改基本关系主码的情况"></a>修改基本关系主码的情况</h3><ul>
<li><strong>RESTRICT 方式</strong>：只有当依赖关系中没有依赖基本关系的外码值，才可以修改/删除</li>
<li><strong>CASCADE 方式</strong>：将依赖关系中依赖基本关系的外码值和主码一同修改/删除</li>
<li><strong>SETNULL 方式</strong>：顾名思义，将依赖关系中依赖基本关系的外码值设为null</li>
</ul>
<h3 id="约束的撤销和添加"><a href="#约束的撤销和添加" class="headerlink" title="约束的撤销和添加"></a>约束的撤销和添加</h3><p>写法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">撤销用: <span class="keyword">alter</span> ... <span class="keyword">drop</span> ...</span><br><span class="line">添加用: <span class="keyword">alter</span> ... <span class="keyword">add</span> ...</span><br></pre></td></tr></table></figure>
<p>示例:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> S <span class="keyword">drop</span> <span class="keyword">constraint</span> S_PK</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> SC <span class="keyword">add</span> <span class="keyword">constraint</span> SC_CHECK</span><br><span class="line">    <span class="keyword">check</span>(Sno <span class="keyword">in</span> <span class="keyword">select</span> Sno <span class="keyword">from</span> S)</span><br></pre></td></tr></table></figure>
<p><strong>域约束的创建添加与撤销</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> domain AGE_DOMAIN <span class="type">smallint</span></span><br><span class="line">    <span class="keyword">constraint</span> DC_AGE <span class="keyword">check</span> (<span class="keyword">value</span> <span class="operator">&lt;=</span> <span class="number">25</span> <span class="keyword">and</span> <span class="keyword">value</span> <span class="operator">&gt;=</span> <span class="number">15</span>)</span><br></pre></td></tr></table></figure>
<h3 id="事务中对完整性约束的违反"><a href="#事务中对完整性约束的违反" class="headerlink" title="事务中对完整性约束的违反"></a>事务中对完整性约束的违反</h3><p>事务中的某一步会暂时违反完整性约束。</p>
<p>例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> person (</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    spouse <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">primary</span> key (name),</span><br><span class="line">    <span class="keyword">foreign</span> key (spouse) <span class="keyword">references</span> person</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> person <span class="keyword">values</span> (<span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;Mary&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>当我还没插入’Mary’时，不可能引用到’Mary’，此时会暂时破坏完整性约束。</p>
<p>默认约束是立即检查，但延迟约束检查可以：</p>
<ul>
<li>在约束声明中加入<code>initially deferred</code>子句，在事务结束时检查。一个约束可以被指定为<code>deferrable</code>可延迟的约束，执行 <code>set constraints constrain-list deferred</code> 命令作为事务的一部分，延迟到事务结束时检查。</li>
</ul>
<h2 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h2><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> assertion <span class="operator">&lt;</span>断言名<span class="operator">&gt;</span> <span class="keyword">check</span> <span class="operator">&lt;</span>条件<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<p>断言是谓词，表达数据库总应该满足的条件。</p>
<ul>
<li>一旦定义了断言，系统验证其有效性，并且对每个可能违反该断言的更新操作都进行检查。</li>
<li>这种检查会带来巨大的系统负载。</li>
<li>对断言“所有X,P(X)“，是通过检查”not exists X, !P(X)” 实现的。</li>
</ul>
<p>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> assertion ASSE2 <span class="keyword">check</span></span><br><span class="line">(<span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> SC</span><br><span class="line">    <span class="keyword">where</span> Cno <span class="keyword">in</span></span><br><span class="line">    (<span class="keyword">select</span> Cno</span><br><span class="line">        <span class="keyword">from</span> C</span><br><span class="line">        <span class="keyword">where</span> TEACHER <span class="operator">=</span> <span class="string">&#x27;张&#x27;</span>)</span><br><span class="line">        <span class="keyword">and</span> Sno <span class="keyword">in</span></span><br><span class="line">    (<span class="keyword">select</span> Sno</span><br><span class="line">        <span class="keyword">from</span> S</span><br><span class="line">        <span class="keyword">where</span> SEX <span class="operator">=</span> <span class="string">&#x27;M&#x27;</span>)))</span><br></pre></td></tr></table></figure>
<h2 id="选看-SQL的数据类型与模式"><a href="#选看-SQL的数据类型与模式" class="headerlink" title="(选看)SQL的数据类型与模式"></a>(选看)SQL的数据类型与模式</h2><p><strong>时间部分：</strong></p>
<ul>
<li><code>time</code> 一天中的时间，时分秒</li>
<li><code>date</code> 日历时期，年月日</li>
<li><code>timestamp</code> date和time的组合</li>
</ul>
<h3 id="日期和时间函数"><a href="#日期和时间函数" class="headerlink" title="日期和时间函数"></a>日期和时间函数</h3><p><code>extract (field from d);</code></p>
<p>获取当前日期，时间函数：</p>
<ul>
<li><code>current_date</code> 返回当前时间</li>
<li><code>current_time</code> 返回当前时间（带时区）</li>
<li><code>local_time</code> 返回当前本地时间（不带时区）</li>
<li><code>current_timestamp</code>, <code>local_timestamp</code> 时间戳</li>
</ul>
<p>运算结果：interval区间类型</p>
<h3 id="类型转换和格式化函数"><a href="#类型转换和格式化函数" class="headerlink" title="类型转换和格式化函数"></a>类型转换和格式化函数</h3><ul>
<li><code>cast (e as t)</code><br>将表达式e转换为类型t</li>
</ul>
<p>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">cast</span>(ID <span class="keyword">as</span> <span class="type">numeric</span>(<span class="number">5</span>)) <span class="keyword">as</span> inst_id</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> inst_id</span><br></pre></td></tr></table></figure>
<ul>
<li>格式化函数<br>MYSQL: <code>format</code> 函数<br>Oracle, PostgreSQL: <code>to_char</code>, <code>to_number</code>, <code>to_date</code></li>
</ul>
<h3 id="缺省值"><a href="#缺省值" class="headerlink" title="缺省值"></a>缺省值</h3><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student (</span><br><span class="line">    id <span class="type">varchar</span>(<span class="number">5</span>),</span><br><span class="line">    ...</span><br><span class="line">    tot_cred <span class="type">numeric</span>(<span class="number">3</span>,<span class="number">0</span>) <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="大对象"><a href="#大对象" class="headerlink" title="大对象"></a>大对象</h3><p>字符数据的大对象clob, 二进制数据的blob。</p>
<p>语法:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bookview <span class="type">clob</span> (<span class="number">10</span>KB)</span><br><span class="line">image <span class="type">blob</span> (<span class="number">10</span>MB)</span><br><span class="line">movie <span class="type">blob</span> (<span class="number">2</span>GB)</span><br></pre></td></tr></table></figure>
<h3 id="用户自定义类型"><a href="#用户自定义类型" class="headerlink" title="用户自定义类型"></a>用户自定义类型</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> type Dollars <span class="keyword">as</span> <span class="type">numeric</span>(<span class="number">12</span>,<span class="number">2</span>) <span class="keyword">final</span></span><br><span class="line"><span class="keyword">create</span> type Ponds <span class="keyword">as</span> <span class="type">numeric</span>(<span class="number">12</span>,<span class="number">2</span>) <span class="keyword">final</span></span><br></pre></td></tr></table></figure>
<p>（一些数据库实现忽略final）<br>即便独特类型的定义是相同的，但不能相互赋值。</p>
<h3 id="create-table的扩展"><a href="#create-table的扩展" class="headerlink" title="create table的扩展"></a>create table的扩展</h3><ul>
<li>创建于现有某模式相同的表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> temp_instructor <span class="keyword">like</span> instructor```</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span>   创建包含查询的结果的表</span><br><span class="line"></span><br><span class="line">```<span class="keyword">sql</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t1 <span class="keyword">as</span> (</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">    ...</span><br><span class="line">) <span class="keyword">with</span> data;</span><br></pre></td></tr></table></figure>
<h2 id="模式、目录和环境"><a href="#模式、目录和环境" class="headerlink" title="模式、目录和环境"></a>模式、目录和环境</h2><p>当代DB实现三层结构：</p>
<ul>
<li>目录catalog</li>
<li>模式schema</li>
<li>关系table, 视图对象view</li>
</ul>
<p>用户连接到数据库后，有一个默认的目录和模式，默认目录和默认模式可以忽略。<br>用<code>create schema</code> 和<code>drop schema</code>创建、忽略模式。</p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><ul>
<li>关系属性中的索引(Index), 可以提高在该属性上查询的速度，无需扫描关系的全部内容。</li>
<li>索引是数据库物理模式的一部分，而非逻辑部分。</li>
<li>索引对数据库的高效处理很重要。但由于索引的空间代价和索引对更新处理的影响，要在维护何种索引上做出正确选择并不容易。</li>
</ul>
<p>语法格式:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index <span class="operator">&lt;</span>索引名<span class="operator">&gt;</span> <span class="keyword">on</span> <span class="operator">&lt;</span>关系名<span class="operator">&gt;</span>(<span class="operator">&lt;</span>属性名<span class="operator">&gt;</span>)</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> index <span class="operator">&lt;</span>索引名<span class="operator">&gt;</span> <span class="keyword">on</span> <span class="operator">&lt;</span>关系名<span class="operator">&gt;</span>(<span class="operator">&lt;</span>属性名<span class="operator">&gt;</span>)</span><br><span class="line"><span class="keyword">drop</span> index <span class="operator">&lt;</span>索引名<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h2><p><strong>授权命令:</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="operator">&lt;</span>权限名<span class="operator">&gt;</span> <span class="keyword">on</span> <span class="operator">&lt;</span>表名<span class="operator">|</span>视图名<span class="operator">&gt;</span> <span class="keyword">to</span></span><br><span class="line"><span class="operator">&lt;</span>用户<span class="operator">/</span>角色列表<span class="operator">|</span>public<span class="operator">&gt;</span> [<span class="keyword">with</span> <span class="keyword">grant</span> option]</span><br></pre></td></tr></table></figure>
<ul>
<li>权限列表包括： selectm update, insert, delete , index alter drop, resource 以及它们的总和all, 其中对select update insert 可以指定属性列表。</li>
<li>with grant option表示获得权限的用户可以把权限再次授予其他用户。</li>
</ul>
<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>, <span class="keyword">insert</span> <span class="keyword">on</span> S <span class="keyword">to</span> Liming</span><br><span class="line"><span class="keyword">with</span> <span class="keyword">grant</span> option</span><br><span class="line"></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> S <span class="keyword">to</span> public</span><br><span class="line"></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">update</span>(budget) <span class="keyword">on</span> department <span class="keyword">to</span> Amit, satoshi</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>收回权限</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">revoke</span> 表级权限 <span class="keyword">on</span> &#123;表名<span class="operator">|</span>视图名&#125; <span class="keyword">from</span> &#123;用户[用户,]... <span class="operator">|</span> public&#125;</span><br></pre></td></tr></table></figure>
<p>收回权限的操作是递归的。</p>
<h3 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h3><ul>
<li><p><strong>创建角色：</strong><br><code>create role instructor;</code></p>
</li>
<li><p><strong>授权角色：</strong><br><code>grant select on takes to instructor;</code></p>
</li>
<li><p>角色可以授予给角色和其他角色</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> instructor <span class="keyword">to</span> Amit;</span><br><span class="line"><span class="keyword">create</span> role dean;</span><br><span class="line"><span class="keyword">grant</span> instructor <span class="keyword">to</span> dean;</span><br><span class="line"><span class="keyword">grant</span> dean <span class="keyword">to</span> Satoshi;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="授权图"><a href="#授权图" class="headerlink" title="授权图"></a>授权图</h3><p>授权图是一棵树，节点是用户，当且仅当存在从根节点R到结点A的路径时，A才拥有权限。</p>
<ul>
<li><p><strong>级联收回(默认)</strong><br>收回权限时，若该用户已将权限授予其他用户，那么也一并收回其子节点的权限，但如果两个结点互为子节点，则循环递归，难以收回。</p>
</li>
<li><p><strong>防止级联收回 restrict</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">revoke</span> <span class="keyword">select</span> <span class="keyword">on</span> department <span class="keyword">from</span> Amit restrict;</span><br></pre></td></tr></table></figure>
<p>如果存在任何级联收回，返回错误，不执行任何收权动作。</p>
</li>
<li><p><strong>仅收回grant option，保留其他权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">revoke</span> <span class="keyword">grant</span> option <span class="keyword">for</span> <span class="keyword">select</span> <span class="keyword">on</span> department <span class="keyword">from</span> Amit;</span><br></pre></td></tr></table></figure>
<p>一些数据库的实现不支持以上语法；可以收回权限，然后不带grant option重新授权。</p>
</li>
<li><p><strong>通过角色授权, 避免用户授权的级联收回</strong><br>1）设置当前会话的当前角色为已定义角色 <code>set role role_name</code><br>2）有当前角色授权，授权语句如 <code>set role role_name</code></p>
</li>
</ul>
<h3 id="数据库级权限授权"><a href="#数据库级权限授权" class="headerlink" title="数据库级权限授权"></a>数据库级权限授权</h3><p>语法:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> 数据库级权限 <span class="keyword">to</span> &#123;<span class="keyword">user</span>[<span class="keyword">user</span> ,]...<span class="operator">|</span>public &#125;</span><br></pre></td></tr></table></figure>
<p>数据库级权限包括:</p>
<ul>
<li><code>connnect</code> 允许用户在database语句中指定数据库</li>
<li><code>resource</code> connect权限+建表，删除表及索引权利</li>
<li><code>dba</code> resource权限+授予或撤销其他用户的connect, resource, dba权限<br>不允许dba撤销自己的dba权限。</li>
</ul>
<h3 id="行级授权"><a href="#行级授权" class="headerlink" title="行级授权"></a>行级授权</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ID <span class="operator">=</span> sys_context(<span class="string">&#x27;USERENV&#x27;</span>, <span class="string">&#x27;SESSION_USER&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>系统将该谓词添加到使用takes关系的每个where子句中，每个学生只能看到与自己ID有关的数据。</p>
<h1 id="使用程序设计语言访问数据库"><a href="#使用程序设计语言访问数据库" class="headerlink" title="使用程序设计语言访问数据库"></a>使用程序设计语言访问数据库</h1><p><strong>动态SQL</strong><br>用函数或者方法与数据库API交互</p>
<ul>
<li>JDBC</li>
<li>从python访问数据库</li>
<li>ODBC</li>
</ul>
<p><strong>嵌入式SQL</strong></p>
<ul>
<li>sql嵌入到宿主语言中</li>
<li>通过预编译程序处理嵌入宿主语言的sql</li>
</ul>
<h2 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h2><p>Java DataBase Connectivity ，面向java的数据库API，原理，体系结构和用法基本都类似ODBC。</p>
<p><strong>工作原理:</strong><br><strong>JDBC的系统架构</strong><br>| | |<br>|—-|—-|<br>| Java application | &darr; |<br>| JDBC API | &darr; |<br>| JDBC Driver Manager | &darr; |<br>| JDBC Driver | JDBC Driver |<br>| Sql Server | Oracle |</p>
<h1 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h1><p>举例：职工工资增幅不超过10%</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> RAISE_LIMIT</span><br><span class="line">after <span class="keyword">update</span> <span class="keyword">of</span> SAL <span class="keyword">on</span> EMP</span><br><span class="line">    <span class="keyword">referencing</span> <span class="keyword">new</span> <span class="type">row</span> <span class="keyword">as</span> nrow <span class="keyword">old</span> <span class="type">row</span> <span class="keyword">as</span> orow</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line">    <span class="keyword">when</span> (nrow.SAL <span class="operator">&gt;</span> <span class="number">1.1</span><span class="operator">*</span>orow.SAL)</span><br><span class="line">        <span class="keyword">begin</span> <span class="keyword">atomic</span></span><br><span class="line">            signal <span class="keyword">SQLSTATE</span>(<span class="string">&#x27;7500&#x27;</span>,<span class="string">&#x27;Salary increase &gt; 10%&#x27;</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://dudujerry452.github.io">dudujerry</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://dudujerry452.github.io/2025/08/21/db-sql/">https://dudujerry452.github.io/2025/08/21/db-sql/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://dudujerry452.github.io" target="_blank">dudujerry的Coding世界!</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/database/">database</a><a class="post-meta__tags" href="/tags/sql/">sql</a></div><div class="post-share"><div class="social-share" data-image="/img/girl_avater.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/08/21/quickfps/" title="简单实现一个多人在线FPS Demo"><img class="cover" src="/images/quickfps/pic1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">简单实现一个多人在线FPS Demo</div></div><div class="info-2"><div class="info-item-1">介绍概念我实现了一个多人在线第一人称射击游戏(Multiplayer-online-sync-FPS)基础框架.   多人在线同步第一人称射击游戏:   第一人称, 指玩家的控制视角为位于眼睛处的摄像头;  多人同步在线, 指支持复数个玩家通过C/S架构实现网络同步, 同时存在于一个地图中移动, 射击, 互动;  射击游戏, 指玩家应当被分为两个阵营(通常包括警和匪), 双方使用枪械对对方进行射击. 人物模型被击中后, 将会根据被击中的部位损失相应血量, 血量归零则被淘汰. 当一个阵营的所有人被淘汰, 或者指定时间内某阵营的淘汰数小于另一阵营(在允许重生的情况下), 则判断该阵营失败, 另一阵营胜利. 除此之外, 还存在其他玩法, 比如匪方出生时携带一个C4炸弹, 若能将C4炸弹安放在若干个指定地点并在指定时间内没有被警方拆除, 则也判定匪方胜利.    源代码已上传至github: QuickFPS 亮点 📦代码至上. 尽可能使用平台无关的C++代码, 尽可能不添加二进制库. 目前不存在平台有关的代码, 只存在raylib二进制库; 🏠结构清晰. 所有的部件均以“模块名/模...</div></div></div></a><a class="pagination-related" href="/2025/08/21/db-summary/" title="数据库总结"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">数据库总结</div></div><div class="info-2"><div class="info-item-1">数据库总结ch1 引言数据抽象  物理层 逻辑层（物理数据独立性） 视图层  数据库定义长期存储在计算机内、有组织的、可共享的大量数据集合 数据库特征   数据按照一定的数据模型组织、描述和存储 可为各种用户共享 冗余度小 数据独立性高 易扩展  数据库管理系统（DBMS） 由一个相互关联的数据的集合和一组用以访问这些数据的程序组成。位于用户与操作系统之间 数据定义语言 (DDL)  定义数据库模式和数据的其他特性的语言  过程化DML：What and how 声明式DML：What，NO how 查询  数据操纵语言（DML）  使得用户可以操纵和访问那些按照适当模型组织起来的数据 完整性约束  域约束：属性的取值必须在某个域内 参照完整性：一个关系的属性集上的取值在另一个关系中必须存在 断言 前二者的超集。数据库需要时刻满足的条件 授权 给予用户不同的权限  实例 特定时刻存储在数据库中的信息的集合 模式 数据库的总体设计称作数据库模式 数据库的三级模式结构   外模式：用户的数据视图；模式的子集；可以有多个 模式：所有用户的公共数据视图；全体模式；只有一个 内模式：数据的...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/08/21/db-summary/" title="数据库总结"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-21</div><div class="info-item-2">数据库总结</div></div><div class="info-2"><div class="info-item-1">数据库总结ch1 引言数据抽象  物理层 逻辑层（物理数据独立性） 视图层  数据库定义长期存储在计算机内、有组织的、可共享的大量数据集合 数据库特征   数据按照一定的数据模型组织、描述和存储 可为各种用户共享 冗余度小 数据独立性高 易扩展  数据库管理系统（DBMS） 由一个相互关联的数据的集合和一组用以访问这些数据的程序组成。位于用户与操作系统之间 数据定义语言 (DDL)  定义数据库模式和数据的其他特性的语言  过程化DML：What and how 声明式DML：What，NO how 查询  数据操纵语言（DML）  使得用户可以操纵和访问那些按照适当模型组织起来的数据 完整性约束  域约束：属性的取值必须在某个域内 参照完整性：一个关系的属性集上的取值在另一个关系中必须存在 断言 前二者的超集。数据库需要时刻满足的条件 授权 给予用户不同的权限  实例 特定时刻存储在数据库中的信息的集合 模式 数据库的总体设计称作数据库模式 数据库的三级模式结构   外模式：用户的数据视图；模式的子集；可以有多个 模式：所有用户的公共数据视图；全体模式；只有一个 内模式：数据的...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/girl_avater.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">dudujerry</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/dudujerry452"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/dudujerry452" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:dudujerry452@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">mathjax慢——公式渲染不出来请等一会</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E5%91%BD%E4%BB%A4"><span class="toc-number">1.</span> <span class="toc-text">SQL命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text">查询结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.1.</span> <span class="toc-text">基本结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.2.</span> <span class="toc-text">详细结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.1.3.</span> <span class="toc-text">其他运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E5%87%BD%E6%95%B0%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-number">1.1.4.</span> <span class="toc-text">重复函数的处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#from%E5%AD%90%E5%8F%A5"><span class="toc-number">1.1.5.</span> <span class="toc-text">from子句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.1.6.</span> <span class="toc-text">自然连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E8%81%9A%E9%9B%86"><span class="toc-number">1.2.</span> <span class="toc-text">分组聚集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.1.</span> <span class="toc-text">分组命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.</span> <span class="toc-text">嵌套子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%88%90%E5%91%98%E8%B5%84%E6%A0%BC"><span class="toc-number">1.3.1.</span> <span class="toc-text">集合成员资格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E7%9A%84%E6%AF%94%E8%BE%83"><span class="toc-number">1.3.2.</span> <span class="toc-text">集合的比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E5%85%B3%E7%B3%BB%E6%B5%8B%E8%AF%95"><span class="toc-number">1.3.3.</span> <span class="toc-text">空关系测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0%E5%AD%98%E5%9C%A8%E6%80%A7%E6%A3%80%E6%B5%8B"><span class="toc-number">1.3.4.</span> <span class="toc-text">重复元素存在性检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#from%E5%AD%90%E5%8F%A5%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.5.</span> <span class="toc-text">from子句中的子查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#with%E5%AD%90%E5%8F%A5"><span class="toc-number">1.4.</span> <span class="toc-text">with子句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E9%87%8F%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.1.</span> <span class="toc-text">标量子查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.</span> <span class="toc-text">插入操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.</span> <span class="toc-text">删除操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C"><span class="toc-number">1.7.</span> <span class="toc-text">更新操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#case%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C"><span class="toc-number">1.7.1.</span> <span class="toc-text">case更新操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.8.</span> <span class="toc-text">连接表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5%E5%92%8C%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.8.1.</span> <span class="toc-text">内连接和外连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">1.9.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE"><span class="toc-number">1.9.1.</span> <span class="toc-text">物化视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E6%9B%B4%E6%96%B0"><span class="toc-number">1.9.2.</span> <span class="toc-text">视图更新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.10.</span> <span class="toc-text">事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.11.</span> <span class="toc-text">完整性约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E5%80%BC%E4%B8%8A%E7%9A%84%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.11.1.</span> <span class="toc-text">属性值上的约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E7%85%A7%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.12.</span> <span class="toc-text">参照完整性约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#references%E5%AD%90%E5%8F%A5"><span class="toc-number">1.12.1.</span> <span class="toc-text">references子句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%9F%BA%E6%9C%AC%E5%85%B3%E7%B3%BB%E4%B8%BB%E7%A0%81%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">1.12.2.</span> <span class="toc-text">修改基本关系主码的情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E7%9A%84%E6%92%A4%E9%94%80%E5%92%8C%E6%B7%BB%E5%8A%A0"><span class="toc-number">1.12.3.</span> <span class="toc-text">约束的撤销和添加</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E4%B8%AD%E5%AF%B9%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F%E7%9A%84%E8%BF%9D%E5%8F%8D"><span class="toc-number">1.12.4.</span> <span class="toc-text">事务中对完整性约束的违反</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%AD%E8%A8%80"><span class="toc-number">1.13.</span> <span class="toc-text">断言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E7%9C%8B-SQL%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%8E%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.14.</span> <span class="toc-text">(选看)SQL的数据类型与模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="toc-number">1.14.1.</span> <span class="toc-text">日期和时间函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%92%8C%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%87%BD%E6%95%B0"><span class="toc-number">1.14.2.</span> <span class="toc-text">类型转换和格式化函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E7%9C%81%E5%80%BC"><span class="toc-number">1.14.3.</span> <span class="toc-text">缺省值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.14.4.</span> <span class="toc-text">大对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.14.5.</span> <span class="toc-text">用户自定义类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#create-table%E7%9A%84%E6%89%A9%E5%B1%95"><span class="toc-number">1.14.6.</span> <span class="toc-text">create table的扩展</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E3%80%81%E7%9B%AE%E5%BD%95%E5%92%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">1.15.</span> <span class="toc-text">模式、目录和环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">1.16.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%88%E6%9D%83"><span class="toc-number">1.17.</span> <span class="toc-text">授权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E8%89%B2"><span class="toc-number">1.17.1.</span> <span class="toc-text">角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%88%E6%9D%83%E5%9B%BE"><span class="toc-number">1.17.2.</span> <span class="toc-text">授权图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BA%A7%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83"><span class="toc-number">1.17.3.</span> <span class="toc-text">数据库级权限授权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E7%BA%A7%E6%8E%88%E6%9D%83"><span class="toc-number">1.17.4.</span> <span class="toc-text">行级授权</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.</span> <span class="toc-text">使用程序设计语言访问数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JDBC"><span class="toc-number">2.1.</span> <span class="toc-text">JDBC</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">触发器</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/30/pca/" title="PCA主成分分析">PCA主成分分析</a><time datetime="2025-08-30T11:11:17.000Z" title="发表于 2025-08-30 19:11:17">2025-08-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/30/cmake-external-project/" title="如何在CMake中独立构建外部项目">如何在CMake中独立构建外部项目</a><time datetime="2025-08-30T03:08:26.000Z" title="发表于 2025-08-30 11:08:26">2025-08-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/29/markov-chain/" title="MP和MDP">MP和MDP</a><time datetime="2025-08-29T12:51:19.000Z" title="发表于 2025-08-29 20:51:19">2025-08-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/28/genetic-algo/" title="遗传算法略解&amp;实践">遗传算法略解&amp;实践</a><time datetime="2025-08-28T08:08:53.000Z" title="发表于 2025-08-28 16:08:53">2025-08-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/21/quickfps/" title="简单实现一个多人在线FPS Demo"><img src="/images/quickfps/pic1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="简单实现一个多人在线FPS Demo"/></a><div class="content"><a class="title" href="/2025/08/21/quickfps/" title="简单实现一个多人在线FPS Demo">简单实现一个多人在线FPS Demo</a><time datetime="2025-08-21T02:19:33.000Z" title="发表于 2025-08-21 10:19:33">2025-08-21</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2019 - 2025 By dudujerry</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>